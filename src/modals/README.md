# Модальные окна

Модальным окном может быть любой React компонент. Его нужно прописать в `@src/modals/imports.ts`. 
За разметку, позиционирование, подложку модального окна отвечает сам компонент. 

```ts
export { default as info } from '@src/modals/defaults/info';
```

Модальное окно можно открыть по его названию сервисом `modals`. 
Первый аргумент - название зарегистрированной модалки. 
Вторым аргументом передаются свойства компонента модалки.

```ts
const result = await services.modals.open('info', {title: 'Информация'});
```

В свойства компонента автоматически передаётся функция обратного вызова `close`.
Функция `close` используется для закрытия окна и для передачи через неё результата.

По умолчанию функция `close` не имеет аргументов для передачи результат модального окна.
Её нужно типизировать явно или можно воспользоваться интерфейсом
`ModalClose<Result>`. В качестве `Result` указывается тип возвращаемого значения. 

```tsx
interface PropsInfo extends ModalClose<number> {
  title: string;
}

function Info(props: PropsInfo): ReactNode {
  return (
    <ModalLayout>
      {props.title} 
      <button onClick={() => props.close(100)}>Закрыть и верунть 100</button>
    </ModalLayout>
  );
}
```

## `service.ts`

Сервис управления модальными окнами. Содержит стек (массив) с парамерами открытых окон, что
обеспечивает одновременное отображение множества окон даже с одинаковым названием.

Сервис предоставляет методы открытия модалки `open` по названию и закрытия `close`. 
При открытии модалки добавляется информация об окне в стек.
При закрытии модалки информация о ней удаляется из стека.
Для каждой модалки генерируется временный уникальный ключ, чтобы по нему закрывать модалку.
И под каждую модалку создаётся функция закрытия. При закрытии будет завершено ожидание (promise) функции открытия модалки.

Функция закрытия передаётся в компонент модалки автоматически. Модалку можно также закрыть 
методом сервиса `services.modals.close(key, result)`. Но тогда нужно знать ключ модалки. Если ключ не 
указать, то закроется последняя открытая модалка.

Сервис реализует интерфейс наблюдателя `Observable` для отслеживания изменений в стеке окон. 
Наблюдатель нужен для перерендера модалок из-за изменения стека открытых модалок.

## `container.tsx`

Контейнер рендерит компоненты модальных окон в соответсвии с информацией в стеке и отслеживает изменения в стеке
для последующего перерендера модалок. Контейнер необходимо вывести в корне приложения, например в App.

```tsx
import Modals from '@src/modals/container';

function App() {
  return (
    <div>
      <Routes>
        {/*роуты на страницы*/}
      </Routes>      
      <Modals/> {/* <--- рендер всех модалок поверх страниц */}      
    </div>
  )
}
```

## `types.ts`

Все типы выводятся автоматически из свойств React компонентов модальных окон, 
подключенных в `@src/modals/imports.ts`. 
Добавлять новые типы или корректировать существующие не требуется.  
